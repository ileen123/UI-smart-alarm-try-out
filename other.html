<!DOCTYPE html>
<html lang="nl">
<head>
    <!-- Meta tags for character encoding and responsive design -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Page title that appears in browser tab -->
    <title>Overige Instellingen</title>
    
    <!-- Google Fonts - Open Sans with multiple weights -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,600;0,700;1,400;1,600&display=swap" rel="stylesheet">
    
    <!-- Link to external CSS file for styling -->
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/slider-component.css">
    
    <!-- WebSocket Communication Scripts -->
    <script src="js/websocket-outbound-client.js"></script>
    <script src="js/websocket-connection-manager.js"></script>
    
    <!-- Data Manager for cross-page data synchronization -->
    <script src="js/shared-data-manager.js"></script>
    
    <!-- Slider Component -->
    <script src="js/slider-component.js"></script>
    
    <!-- Heart Circle Component -->
    <script src="js/heart-circle-component.js"></script>
</head>
<body>
    <!-- Breadcrumb Navigation -->
    <nav class="breadcrumb-nav">
        <a href="#" class="breadcrumb-link" onclick="goToBedOverview()">
            <img src="svg's/Home.svg" alt="Home" class="breadcrumb-icon">
            Kamer Overzicht
        </a>
        <span class="breadcrumb-separator">></span>
        <a href="#" class="breadcrumb-link" onclick="goBackToAlarmOverview()">Alarm Instellingen - S. Groen</a>
        <span class="breadcrumb-separator">></span>
        <span class="breadcrumb-current">Overige Monitoring</span>
    </nav>

    <!-- Title and Patient Info Layout -->
    <div class="title-patient-layout">
        <!-- Main page title -->
        <h1 class="main-title">Overige Monitoring</h1>
        
        <!-- Patient information header section -->
        <div class="header">
            <img src="svg's/patient_icon.svg" alt="Patient" class="user-icon" />
            <span id="patient-header-info">Loading patient info...</span>
        </div>
    </div>
    
    <!-- Main content container -->
    <div class="circulatoir-settings-container">
        
        <!-- Monitoring Level Controls -->
        <div class="monitoring-controls-layout">
            <!-- Monitoring buttons - now direct children -->
            <div class="monitoring-buttons-direct">
                <h3 class="info-title">Alarm Level</h3>
                <div class="button-group">
                    <button class="btn risk-low" data-level="loose" onclick="changeMonitoringLevel('loose')">Los</button>
                    <button class="btn risk-med selected" data-level="mid" onclick="changeMonitoringLevel('mid')">Mid</button>
                    <button class="btn risk-high" data-level="tight" onclick="changeMonitoringLevel('tight')">Strak</button>
                </div>
            </div>
            
            <!-- Heart circle - now direct child -->
            <div class="heart-circle-direct">
                <h3 class="info-title"> </h3>
                <div id="respiratory-heart-circle-container"></div>
            </div>
            
            <!-- Additional Circulatory Information Container -->
            <div class="additional-circulatory-info">
                <h3 class="info-title">Overige additionele informatie:</h3>
                <div class="circulatory-tags-section">
                <!-- Temperature monitoring tags could go here in the future -->
                    <button class="btn tag-btn circulatory-tag" data-condition="pneumonie">
                        Pneumonie <img src="svg's/lung.svg" alt="Pneumonie" class="condition-icon">
                    </button>
                    <button class="btn tag-btn" data-condition="herstellende">
                        Herstellende <img src="svg's/patient_icon.svg" alt="Herstellende" class="condition-icon">
                    </button>
                    <button class="circulatory-more-btn">⋯</button>
                </div>
            </div>
        </div>
        
        
        <!-- Section title moved outside the container -->
        <h2 class="section-title">Overige Streefgebieden Aanpassen</h2>
        
        <!-- Interactive Slider Demo Section -->
        <div class="slider-demo-section">
            
            <!-- Single temperature slider container -->
            <div class="sliders-layout">
                <div class="temp-slider-with-legend">
                    <div id="temp-slider-container" class="individual-slider"></div>
                    <div class="alarm-legend">
                        <div class="legend-item">
                            <div class="legend-color green"></div>
                            <span>Acceptabel</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color yellow"></div>
                            <span>Lichte overschrijding</span>
                        </div>
                        
                        <div class="legend-item">
                            <div class="legend-color red"></div>
                            <span>Significante overschrijding</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation section with back button -->
    <div class="bottom-left-nav">
        <button class="nav-button back-button" onclick="goBackToAlarmOverview()">
            ← Terug naar Alarm Overzicht
        </button>
    </div>

    <!-- Bottom right navigation button -->
    <div class="bottom-right-nav">
        <button class="nav-button" onclick="goToCirculatorySettings()">Naar Circulatoir →</button>
    </div>

    <style>
        /* Page-specific gradient background - only for respiratory settings page */
        body {
            background: linear-gradient(to bottom, #ffffff 0%, #ffffff 10%, #E6E4E0 100%);
            min-height: 100vh; /* Ensure full viewport height for gradient */
            padding: 50px 200px 5px 200px; /* Further reduced padding for no scrolling */
            margin: 0;
            font-family: 'Open Sans', sans-serif;
        }

        /* Breadcrumb Navigation */
        .breadcrumb-nav {
            font-family: 'Open Sans', sans-serif;
            font-size: 14px;
            color: #FC6039;
            margin-bottom: 25px;
            padding-top: 10px;
            display: flex;
            align-items: center;
            line-height: 1.2;
        }

        .breadcrumb-link {
            color: #FC6039;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            transition: opacity 0.2s ease;
            vertical-align: middle;
        }

        .breadcrumb-link:hover {
            opacity: 0.8;
            text-decoration: underline;
        }

        .breadcrumb-icon {
            width: 16px;
            height: 16px;
            margin-right: 4px;
            filter: brightness(0) saturate(100%) invert(44%) sepia(93%) saturate(1352%) hue-rotate(346deg) brightness(119%) contrast(119%);
            vertical-align: middle;
        }

        .breadcrumb-separator {
            margin: 0 8px;
            color: #FC6039;
            font-weight: normal;
        }

        .breadcrumb-current {
            color: #FC6039;
            font-weight: 600;
        }
        
        /* Title and Patient Info Layout */
        .title-patient-layout {
            display: flex;
            align-items: center;
            margin-top: 15px;
            margin-bottom: 20px;
            position: relative;
        }
        
        .title-patient-layout .main-title {
            margin: 0; /* Remove default margin */
            flex: 0 0 auto; /* Don't grow or shrink */
        }
        
        /* Position header to align with the right edge of additional-circulatory-info */
        .header {
            width: fit-content; /* Resize to content width */
            margin: 0; /* Remove default margins */
            position: absolute;
            right: 0; /* Align to the right edge of the container */
            /* This will align with the additional info box since both are in the same container width */
        }
        
        /* Monitoring Level Controls - matching risk level button styling */
        .monitoring-level-controls {
            margin: 0px 0; /* Further reduced from 15px */
            text-align: left; /* Changed from center to left */
            background: rgba(255, 255, 255, 0);
            padding: 0px; /* Further reduced from 20px */
            border-radius: 10px;
            /* box-shadow: 0 2px 4px rgba(0,0,0,0.1); */ /* Shadow removed */
            border: 1px solid #e9ecef;
        }
        
        .monitoring-level-controls .section-title {
            color: #2c3e50;
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 10px;
            text-align: left; /* Ensure title is also left-aligned */
        }
        
        .monitoring-description {
            color: #6c757d;
            font-size: 16px;
            margin-bottom: 10px; /* Further reduced from 15px */
            text-align: left; /* Changed from default to explicitly left */
        }
        
        /* Layout for monitoring controls and heart circle - horizontal sections */
        .monitoring-controls-layout {
            display: flex;
            gap: -400px; /* Further reduced gap to bring heart circle even closer */
            margin-top: 3px; /* Further reduced from 5px */
            margin-bottom: 10px; /* Further reduced from 15px */
            align-items: flex-start;
            width: 100%;
            position: relative;
        }
        
        .monitoring-buttons-direct {
            flex: 1;
            /* Container properties removed - now direct on page */
            padding: 12px 15px 15px 0px; /* Removed left padding to align with title */
            min-height: 120px; /* Reduced to match additional info container */
            max-height: 120px; /* Reduced to match additional info container */
            display: flex;
            flex-direction: column;
        }
        
        .heart-circle-direct {
            flex: 1;
            /* Container properties removed - now direct on page */
            padding: 0px 15px 15px 15px; /* Further reduced padding */
            margin-left: -300px; /* Increased negative margin to move heart circle closer to monitoring buttons */
            min-height: 200px; /* Reduced from 240px to make it more compact */
            max-height: 200px; /* Reduced from 240px to make it more compact */
            display: flex;
            flex-direction: column;
            align-items: left;
            justify-content: flex-start;
            overflow: visible; /* Changed from hidden to visible to show full circle */
            position: relative;
        }
        
        .heart-circle-label {
            color: #6c757d;
            font-size: 14px;
            font-weight: 500;
            text-align: center;
        }
        
        #respiratory-heart-circle-container {
            width: 220px;
            height: 220px;
            max-width: 100%;
            max-height: 260px;
            position: relative;
            z-index: 1;
            display: flex;
            align-items: center;
            justify-content: flex-start; /* Changed from center to flex-start to move left */
            margin: 0;
            padding-top: 12px;
            overflow: visible; /* Ensure circle content is not clipped */
        }
        .heart-organ-circle {
            opacity: 1 !important;
            position: relative !important;
        }
        
        /* Specific override for respiratory page heart circle positioning */
        #respiratory-heart-circle-container .heart-organ-circle {
            justify-content: flex-start !important;
            margin: 0 !important;
        }
        
        /* Additional Circulatory Information Container - matches alarm overview form-section */
        .additional-circulatory-info {
            flex: 1.05; /* Further reduced for better proportions */
            display: flex;
            flex-direction: column;
        }
        
        .circulatory-tags-section {
            background: #C2E4FF;
            padding: 15px 20px 20px 20px;
            border-radius: 30px 0px 30px 0px;
            min-height: 100px; /* Reduced since title is outside */
            max-height: 100px;
            display: flex;
            gap: 8px; /* Reduced from 15px to bring buttons closer */
            flex-wrap: wrap;
            align-items: flex-start;
        }
        
        /* General info-title styling for all containers */
        .info-title {
            font-size: 18px;
            font-weight: 600;
            color: #1961AB;
            margin: 0;
            margin-bottom: 15px;
            text-align: left;
            position: relative;
            z-index: 2;
        }
        
        .additional-circulatory-info .info-title {
            font-size: 18px;
            font-weight: 600;
            color: #1961AB;
            margin: 0;
            margin-bottom: 8px; /* Reduced margin to bring container closer */
            margin-left: 0px; /* Reduced left margin for better alignment */
            text-align: left;
            position: relative;
            background: transparent; /* Ensure no background */
            z-index: 10; /* Position above the blue container */
        }

        .monitoring-buttons-direct .info-title {
            font-size: 18px;
            font-weight: 600;
            color: #1961AB;
            margin: 0;
            margin-bottom: 8px; /* Match additional info title margin */
            text-align: left;
            position: relative;
            z-index: 2;
        }
        
        /* Using standard tag styling from styles.css - no custom circulatory styling needed */
        
        .circulatory-tag {
            padding: 6px 12px;
            font-size: 13px;
            white-space: nowrap;
            border-radius: 20px;
            background-color: #bbdefb;
            border: 2px solid #1961AB;
            color: #1961AB;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            width: auto;
            flex-shrink: 0;
            flex-grow: 0;
        }
        
        .circulatory-tag:hover {
            background: #90caf9;
            border-color: #64b5f6;
        }
        
        .circulatory-tag.selected {
            background-color: #1961AB;
            color: white;
            border-color: #1961AB;
            font-weight: 600;
        }
        
        .circulatory-more-btn {
            background-color: #ff6b35;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: none;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .circulatory-more-btn:hover {
            background-color: #e55a2b;
            transform: scale(1.05);
        }
        
        /* Tag button styling - matches circulatory-tag styling */
        .tag-btn {
            padding: 6px 12px;
            font-size: 13px;
            white-space: nowrap;
            border-radius: 20px;
            background-color: #bbdefb;
            border: 2px solid #1961AB;
            color: #1961AB;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            width: auto;
            flex-shrink: 0;
            flex-grow: 0;
        }
        
        .tag-btn:hover {
            background: #90caf9;
            border-color: #64b5f6;
        }
        
        .tag-btn.selected {
            background-color: #1961AB;
            color: white;
            border-color: #1961AB;
            font-weight: 600;
        }
        
        /* Tag button icon styling */
        .tag-btn .condition-icon {
            width: 16px;
            height: 16px;
            margin-left: 6px;
            filter: brightness(0) saturate(100%) invert(25%) sepia(64%) saturate(2570%) hue-rotate(201deg) brightness(93%) contrast(92%);
            transition: filter 0.2s ease;
        }
        
        .tag-btn.selected .condition-icon {
            filter: brightness(0) saturate(100%) invert(100%) sepia(0%) saturate(7500%) hue-rotate(109deg) brightness(103%) contrast(103%);
        }
        
        /* Slider containers and titles */
        .slider-demo-section {
            margin: 8px 0; /* Further reduced from 12px for tighter spacing */
            max-width: 1920px; /* Use full width */
            margin-left: auto;
            margin-right: auto;
            padding: 0; /* Remove padding to align with body padding */
            /* flex: 1; */ /* Remove flex:1 - don't take remaining space */
        }
        
        .slider-demo-section .section-title {
            color: #1961AB;
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 0px;
            text-align: left;
        }
        
        .demo-description {
            color: #6c757d;
            font-size: 16px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .sliders-layout {
            display: flex;
            gap: 40px; /* Reduced from 120px for compact layout */
            justify-content: center;
            flex-wrap: nowrap; /* Force horizontal layout, no wrapping */
            margin: -20px auto;
            align-items: flex-start; /* Align sliders at the top */
        }
        
        .individual-slider {
            flex: 0 0 auto; /* Don't grow or shrink, use natural size */
            min-width: 400px; /* Reduced from 500px */
            max-width: 450px; /* Reduced from 600px */
        }

        /* AF Slider with Legend Layout */
        .af-slider-with-legend {
            display: flex;
            gap: 100px;
            align-items: center; /* This centers the legend vertically */
        }

        /* Temperature Slider with Legend Layout */
        .temp-slider-with-legend {
            display: flex;
            gap: 100px;
            align-items: center; /* This centers the legend vertically */
        }

        /* Alarm Legend Styles */
        .alarm-legend {
            background: white;
            border-radius: 8px;
            padding: 15px; /* Reduced from 20px */
            /* border: 1px solid #e9ecef; */ /* Border removed */
            min-width: 160px; /* Reduced from 200px */
            /* margin-top removed - flexbox centering handles positioning */
        }

        .alarm-legend h4 {
            font-family: 'Open Sans', sans-serif;
            color: black;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            text-align: center;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 10px;
            font-family: 'Open Sans', sans-serif;
        }

        .legend-item:last-child {
            margin-bottom: 0;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .legend-color.green {
            background-color: #00C877;
        }

        .legend-color.yellow {
            background-color: #ECEC3E;
        }

        .legend-color.orange {
            background-color: #F0973E;
        }

        .legend-color.red {
            background-color: #EB4921;
        }

        .legend-item span {
            color: black;
            font-size: 14px;
            font-weight: 400;
        }
        .nav-button {
            background-color: transparent;
            border: 2px solid #ff6b35;
            border-radius: 20px;
            padding: 10px 20px;
            font-size: 16px;
            font-weight: 600;
            font-family: 'Open Sans', sans-serif;
            color: #ff6b35;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }
        
        .nav-button:hover {
            background-color: #ff6b35;
            border-color: #ff6b35;
            color: white;
            transform: translateY(-2px);
        }
        
        /* Bottom right navigation button */
        .bottom-right-nav {
            position: fixed;
            bottom: 63px;
            right: 200px;
            z-index: 1000;
        }
        
        /* Bottom left navigation button - matching right button positioning */
        .bottom-left-nav {
            position: fixed;
            bottom: 63px;
            left: 200px;
            z-index: 1000;
        }
        
        .subtitle {
            text-align: left; /* Changed from center to left */
            color: #6c757d;
            font-size: 18px;
            margin-bottom: 30px;
            font-weight: 400;
        }
        
        .circulatoir-settings-container {
            max-width: 1920px; /* Use full width for 1920x1080 */
            margin: 0 auto;
            padding: 0; /* Remove padding to align with body padding */
            /* height: calc(100vh - 30px); */ /* Remove fixed height - let content determine height */
            display: flex;
            flex-direction: column;
        }
        
        .parameter-section {
            background: white;
            border-radius: 12px;
            padding: 18px; /* Further reduced from 20px */
            margin-bottom: 15px; /* Further reduced from 20px */
            /* box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); */ /* Shadow removed */
            border: 1px solid #e9ecef;
        }
        
        .parameter-title {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 18px; /* Reduced from 25px */
            color: #cd3ae1;
            font-size: 24px;
            font-weight: 600;
        }
        
        .heart-icon, .bp-icon {
            font-size: 32px;
        }
        
        .range-display {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f8f9fa;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .current-range {
            font-size: 20px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .range-status {
            font-size: 14px;
            color: #28a745;
            font-weight: 500;
        }
        
        .adjustment-controls {
            margin-bottom: 20px;
        }
        
        .range-input-group {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .range-input-group label {
            font-weight: 600;
            color: #495057;
            flex: 1;
        }
        
        .input-with-unit {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .input-with-unit input {
            width: 80px;
            padding: 8px 12px;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            font-size: 16px;
            text-align: center;
        }
        
        .input-with-unit input:focus {
            outline: none;
            border-color: #1961AB;
            /* box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1); */ /* Shadow removed */
        }
        
        .unit {
            font-weight: 600;
            color: #6c757d;
            min-width: 50px;
        }
        
        .preset-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .preset-btn {
            background-color: #e9ecef;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            padding: 8px 16px;
            font-size: 14px;
            font-weight: 500;
            color: #495057;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .preset-btn:hover {
            background-color: #1961AB;
            border-color: #1961AB;
            color: white;
        }
        
        .action-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin: 40px 0;
        }
        
        .action-btn {
            padding: 15px 30px;
            font-size: 16px;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 200px;
        }
        
        .reset-btn {
            background-color: #6c757d;
            color: white;
        }
        
        .reset-btn:hover {
            background-color: #5a6268;
            transform: translateY(-2px);
        }
        
        .save-btn {
            background-color: #28a745;
            color: white;
        }
        
        .save-btn:hover {
            background-color: #218838;
            transform: translateY(-2px);
        }
        
        .settings-preview {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            border: 2px solid #dee2e6;
        }
        
        .settings-preview h3 {
            margin-bottom: 20px;
            color: #2c3e50;
            font-size: 20px;
            text-align: center;
        }
        
        .preview-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 12px 0;
            border-bottom: 1px solid #dee2e6;
        }
        
        .preview-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        
        .preview-label {
            font-weight: 600;
            color: #495057;
        }
        
        .preview-value {
            font-weight: 600;
            color: #1961AB;
            font-size: 16px;
        }
        
        /* Slider Demo Section Styles */
        .slider-demo-section {
            background: #ffffff;
            border-radius: 0px 30px 0px 30px;
            padding: 20px; /* Add some padding instead of fixed height */
            margin-top: 0px;
            width: 1520px;
            /* height: 120px; */ /* Remove fixed height - let content determine size */
            height: auto; /* Let content determine height */
        }
        
        .slider-demo-section h3 {
            color: #2c3e50;
            font-size: 22px;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .demo-description {
            text-align: center;
            color: #6c757d;
            font-size: 16px;
            margin-bottom: 25px;
            line-height: 1.5;
        }
        
        .slider-containers {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }
        
        .slider-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            /* box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); */ /* Shadow removed */
            border: 1px solid #e9ecef;
        }
        
        .slider-container h4 {
            color: #495057;
            font-size: 18px;
            margin-bottom: 15px;
            text-align: center;
            font-weight: 600;
        }
        
        .slider-container > div {
            min-height: 300px;
        }
        
        /* Monitoring Level Controls */
        .monitoring-level-controls {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        
        .monitoring-level-controls h4 {
            color: #495057;
            font-size: 18px;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .monitoring-description {
            color: #6c757d;
            font-size: 14px;
            margin-bottom: 20px;
        }
        
        .level-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
        }
        
        .level-btn {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 15px 20px;
            font-size: 14px;
            color: #495057;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 120px;
        }
        
        .level-btn:hover {
            background: #e9ecef;
            border-color: #adb5bd;
            transform: translateY(-2px);
        }
        
        .level-btn.active {
            background: #1961AB;
            border-color: #1961AB;
            color: white;
        }
        
        .level-btn strong {
            display: block;
            margin-bottom: 5px;
            font-size: 16px;
        }
        
        .level-btn span {
            font-size: 12px;
            opacity: 0.8;
        }
        
        /* Responsive design */
        @media (max-width: 768px) {
            .circulatoir-settings-container {
                padding: 10px;
            }
            
            .parameter-section {
                padding: 20px;
            }
            
            .range-input-group {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            
            .action-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .preset-buttons {
                justify-content: center;
            }
        }
    </style>

    <script>
        // Global variables
        let currentPatientId = null;
        let currentBed = null;
        let currentSettings = {};

        // SINGLE SOURCE OF TRUTH: Initialize currentSettings from unified data
        function initializeCurrentSettings() {
            if (currentPatientId && window.sharedDataManager) {
                console.log('🎯 OTHER: Initializing with single source of truth for patient:', currentPatientId);
                
                // Get ALL effective values in one call (prevents stacking)
                const effectiveValues = window.sharedDataManager.getCurrentEffectiveValues(
                    currentPatientId, 
                    { useCache: true } // Use cache during initialization to prevent redundancy
                );
                
                console.log('📦 OTHER: Received effective values package:', effectiveValues);
                
                if (effectiveValues && effectiveValues.parameterRanges) {
                    const ranges = effectiveValues.parameterRanges;
                    
                    currentSettings = {
                        temperature: {
                            min: ranges.Temperature?.min || window.TEMP_MIN || 36.0,
                            max: ranges.Temperature?.max || window.TEMP_MAX || 38.5
                        }
                    };
                } else {
                    // Fallback to global variables
                    currentSettings = {
                        temperature: { min: window.TEMP_MIN || 36.0, max: window.TEMP_MAX || 38.5 }
                    };
                }
                console.log('🌡️ Other currentSettings initialized from SharedDataManager:', currentSettings);
            } else {
                // Default fallback
                currentSettings = {
                    temperature: { min: 36.0, max: 38.5 }
                };
                console.log('🌡️ Other currentSettings initialized with defaults:', currentSettings);
            }
        }

        
        // Store slider references for monitoring level changes
        let tempSlider = null;

        // Initialize page when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            initializePage();
            setupEventListeners();
            initializeConditionStates(); // Initialize condition button states from SharedDataManager
            
            // Initialize global variables system (simple approach)
            if (window.sharedDataManager) {
                window.sharedDataManager.loadGlobalParameterVariables();
                console.log('✅ Global variables loaded for other page');
            }

            // Initialize heart circle component (same as alarm overview)
            setTimeout(() => {
                initializeHeartCircleComponent();
                initializeSliders();
                
                // SIMPLE APPROACH: Global variables are automatically loaded and used
                console.log('✅ Sliders initialized - using global variables approach');
            }, 1000);
        // Heart, Lung, and Temperature SVG content
        const svgContent = {
            heart: `<svg class="organ-icon" viewBox="0 0 22 26" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M13.22 10.3743C12.0679 12.132 10.9163 15.0615 10.9163 19.1628M13.22 10.3743C12.0681 12.132 11.4922 14.4756 6.30842 14.4756M13.22 10.3743C14.6766 8.39884 16.9516 6.83964 19.3552 6.3986C20.0557 6.27006 20.6011 5.62288 20.4841 4.90863L20.2921 3.73684C20.1996 3.17181 19.7182 2.75127 19.159 2.81881C16.3987 3.15222 12.9705 4.8327 10.9162 7.44486C10.9162 6.27307 10.9162 2.75769 10.3402 1M5.73245 6.85896C5.15648 5.10127 4.00454 3.92948 2.27663 3.92948M1.70071 15.6441C2.85258 20.9171 7.26892 25 10.3401 25C13.4113 25 17.6365 20.9175 18.9799 15.6441C20.3232 10.3707 16.1 6.85563 13.2201 10.371C13.2201 8.61732 11.4922 6.85906 8.03639 6.85906C4.58057 6.85906 0.548838 10.371 1.70071 15.6441Z" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>`,
            lung: `<svg class="organ-icon" viewBox="0 0 30 26" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M11.5007 5.62881C11.5007 4.02205 10.3628 2.41595 5.90178 6.31748C-0.397037 11.8263 1.7026 24.2213 2.40247 24.91C3.10233 25.5986 10.8008 22.1555 11.5007 20.7783C12.2006 19.4011 10.8008 17.3352 12.2006 14.5808M18.4993 5.62879C18.4993 4.02203 19.6372 2.41593 24.0982 6.31746C30.397 11.8263 28.2974 24.2213 27.5975 24.9099C26.8977 25.5985 19.1992 22.1555 18.4993 20.7783C17.7994 19.401 19.1992 17.3352 17.7994 14.5807M21.9987 16.6468C21.9987 13.3949 19.8717 11.7738 18.2519 10.7191C14.9109 8.54378 15 4.4935 15 0.999945C15 4.4935 15.0891 8.54378 11.7481 10.7191C10.1283 11.7738 8.00142 13.3949 8.00142 16.6468" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>`,
            temp: `<svg class="organ-icon" viewBox="0 0 16 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M5.71349 0C3.94455 0 2.4982 1.42157 2.4982 3.15972V13.7459C0.944989 14.7857 0.000507593 16.5193 0 18.3844C0 21.4774 2.56656 24 5.71349 24C8.86042 24 11.4265 21.4774 11.4265 18.3844C11.4265 16.5193 10.482 14.7842 8.92828 13.7444V3.15972C8.92828 1.42157 7.48193 0 5.71349 0ZM5.71349 1.41162C6.71166 1.41162 7.49206 2.17865 7.49206 3.15972V14.1326C7.49212 14.2565 7.52539 14.3783 7.58851 14.4856C7.65162 14.5929 7.74237 14.682 7.85162 14.7438C9.17643 15.4954 9.99076 16.8812 9.99076 18.3844C9.99076 20.7144 8.08457 22.5884 5.714 22.5879C5.71383 22.5879 5.71416 22.5879 5.714 22.5879C3.34393 22.5884 1.43673 20.7144 1.43673 18.3849C1.43724 16.8822 2.25207 15.4964 3.57587 14.7453C3.68512 14.6834 3.77586 14.5944 3.83898 14.4871C3.9021 14.3798 3.93536 14.258 3.93543 14.1341V3.15972C3.93543 2.17865 4.71482 1.41162 5.71349 1.41162ZM11.5885 1.87453C11.3981 1.87455 11.2154 1.94891 11.0808 2.08127C10.9461 2.21363 10.8704 2.39315 10.8704 2.58033C10.8704 2.76752 10.9461 2.94704 11.0808 3.0794C11.2154 3.21176 11.3981 3.28613 11.5885 3.28615H15.2819C15.4723 3.28613 15.655 3.21176 15.7897 3.0794C15.9243 2.94704 16 2.76752 16 2.58033C16 2.39315 15.9243 2.21363 15.7896 2.08127C15.655 1.94891 15.4723 1.87455 15.2819 1.87453H11.5885ZM5.71349 2.58033C5.61915 2.58028 5.52572 2.59849 5.43854 2.63394C5.35136 2.66938 5.27214 2.72136 5.2054 2.7869C5.13867 2.85245 5.08572 2.93028 5.0496 3.01594C5.01348 3.1016 4.99488 3.19342 4.99487 3.28615V15.2102C3.51864 15.5338 2.40552 16.8384 2.40552 18.3834C2.40552 20.1708 3.89492 21.6347 5.71349 21.6347C7.53156 21.6347 9.02146 20.1708 9.02146 18.3834C9.02146 16.8384 7.90783 15.5348 6.4316 15.2102V3.28615C6.43158 3.09896 6.35592 2.91944 6.22125 2.78708C6.08658 2.65472 5.90394 2.58035 5.71349 2.58033ZM11.5885 5.10144C11.4942 5.10145 11.4008 5.11973 11.3136 5.15523C11.2265 5.19073 11.1473 5.24277 11.0806 5.30836C11.0139 5.37395 10.961 5.45182 10.925 5.5375C10.8889 5.62319 10.8704 5.71502 10.8704 5.80775C10.8704 5.99493 10.9461 6.17445 11.0808 6.30681C11.2154 6.43917 11.3981 6.51353 11.5885 6.51355H13.8431C14.0336 6.51353 14.2162 6.43917 14.3509 6.30681C14.4856 6.17445 14.5612 5.99493 14.5612 5.80775C14.5613 5.71502 14.5428 5.62319 14.5067 5.5375C14.4707 5.45182 14.4178 5.37395 14.3511 5.30836C14.2844 5.24277 14.2052 5.19073 14.1181 5.15523C14.0309 5.11972 13.9375 5.10145 13.8431 5.10144H11.5885ZM11.5885 8.32885C11.3981 8.32886 11.2154 8.40323 11.0808 8.53559C10.9461 8.66796 10.8704 8.84747 10.8704 9.03466C10.8704 9.22184 10.9461 9.40136 11.0808 9.53372C11.2154 9.66608 11.3981 9.74045 11.5885 9.74046H15.2819C15.4723 9.74045 15.655 9.66608 15.7896 9.53372C15.9243 9.40136 16 9.22184 16 9.03466C16 8.84747 15.9243 8.66796 15.7897 8.53559C15.655 8.40323 15.4723 8.32886 15.2819 8.32885H11.5885ZM11.5885 11.5563C11.3981 11.5563 11.2154 11.6306 11.0808 11.763C10.9461 11.8954 10.8704 12.0749 10.8704 12.2621C10.8704 12.4493 10.9461 12.6288 11.0808 12.7611C11.2154 12.8935 11.3981 12.9679 11.5885 12.9679H13.8431C14.0336 12.9679 14.2162 12.8935 14.3509 12.7611C14.4856 12.6288 14.5612 12.4493 14.5612 12.2621C14.5612 12.0749 14.4856 11.8954 14.3509 11.763C14.2162 11.6306 14.0336 11.5563 13.8431 11.5563H11.5885ZM5.71349 16.5437C6.75571 16.5437 7.58473 17.359 7.58473 18.3834C7.58473 19.4078 6.75571 20.2231 5.71349 20.2231C4.67127 20.2231 3.84174 19.4078 3.84174 18.3834C3.84174 17.359 4.67127 16.5437 5.71349 16.5437Z" fill="black"/>
            </svg>`
        };

        // Utility to inject SVG content into the heart circle
        function injectSVG(containerId, svgType) {
            const container = document.getElementById(containerId);
            if (!container) return;
            const iconDiv = container.querySelector('.heart-white-center');
            if (iconDiv) {
                iconDiv.innerHTML = svgContent[svgType];
                const svgEl = iconDiv.querySelector('svg');
                if (svgEl) {
                    svgEl.style.width = '70%';
                    svgEl.style.height = '70%';
                    svgEl.style.display = 'block';
                    svgEl.style.margin = '0 auto';
                }
            } else {
                setTimeout(() => injectSVG(containerId, svgType), 50);
            }
        }

        // Initialize the heart circle component in respiratory settings
        function initializeHeartCircleComponent() {
            // Use same size as alarm overview
            const circleSize = 130;
            
            // Get EFFECTIVE monitoring level from SharedDataManager (including tag adjustments)
            let initialLevel = 'mid';
            if (currentPatientId && window.sharedDataManager) {
                initialLevel = window.sharedDataManager.getEffectiveTempMonitoringLevel(currentPatientId);
                console.log(`Loading EFFECTIVE temp monitoring level for patient ${currentPatientId}:`, initialLevel);
            }
            
            window.tempCircle = new HeartCircleComponent('respiratory-heart-circle-container', { 
                size: circleSize, 
                initialState: initialLevel 
            });
            setTimeout(() => injectSVG('respiratory-heart-circle-container', 'temp'), 100);
            
            // Map heart circle levels to button levels for initial setup
            const levelMapping = {
                'low': 'loose',
                'mid': 'mid', 
                'high': 'tight'
            };
            
            const buttonLevel = levelMapping[initialLevel] || 'mid';
            
            // Update button states to match loaded level
            updateButtonStates(buttonLevel);
            
            // Update sliders to match loaded level (wait for sliders to be initialized)
            setTimeout(() => {
                updateSlidersMonitoringLevel(buttonLevel);
            }, 1500); // Wait for sliders to be fully initialized
            
            // Listen for global temp monitoring level changes
            document.addEventListener('tempMonitoringLevelChanged', function(event) {
                const { patientId, level } = event.detail;
                if (patientId === currentPatientId) {
                    console.log(`Received temp monitoring level change for patient ${patientId}:`, level);
                    if (window.tempCircle) {
                        window.tempCircle.setRiskLevel(level);
                    }
                    
                    const buttonLevel = levelMapping[level] || 'mid';
                    updateButtonStates(buttonLevel);
                    updateSlidersMonitoringLevel(buttonLevel);
                }
            });
        }
        
        // Helper function to update button states
        function updateButtonStates(level) {
            // Map heart circle levels back to button levels
            const levelMapping = {
                'low': 'loose',
                'mid': 'mid', 
                'high': 'tight',
                'loose': 'loose',  // fallback mappings
                'tight': 'tight'
            };
            
            const mappedLevel = levelMapping[level] || level;
            console.log(`Updating button states: ${level} → ${mappedLevel}`);
            
            // Update button states
            document.querySelectorAll('.button-group .btn').forEach(btn => {
                btn.classList.remove('active', 'selected');
            });
            
            const selectedButton = document.querySelector(`[data-level="${mappedLevel}"]`);
            if (selectedButton) {
                selectedButton.classList.add('selected');
                console.log(`✅ Button ${mappedLevel} selected in updateButtonStates`);
            } else {
                console.warn(`❌ Button with data-level="${mappedLevel}" not found`);
            }
        }
        });

        // Helper function to update sliders monitoring level (moved outside closure for global access)
        function updateSlidersMonitoringLevel(level) {
            console.log(`🎛️ Updating temperature slider monitoring level to: ${level}`);
            console.log('🔍 DEBUG - tempSlider exists:', !!tempSlider);
            
            if (tempSlider) {
                console.log('🔍 DEBUG - tempSlider type:', typeof tempSlider);
                console.log('🔍 DEBUG - tempSlider.updateMonitoringLevel exists:', typeof tempSlider.updateMonitoringLevel);
            }
            
            // Update Temperature slider if it exists
            if (tempSlider && typeof tempSlider.updateMonitoringLevel === 'function') {
                console.log('🎛️ Calling tempSlider.updateMonitoringLevel with:', level);
                tempSlider.updateMonitoringLevel(level);
                console.log('✅ Temperature slider monitoring level updated to:', level);
            } else {
                console.warn('❌ Temperature slider not found or updateMonitoringLevel method not available');
                console.warn('❌ tempSlider:', tempSlider);
                if (tempSlider) {
                    console.warn('❌ Available methods:', Object.getOwnPropertyNames(tempSlider));
                }
            }
        }

        // Function to change monitoring level for all sliders
        function changeMonitoringLevel(level) {
            console.log(`🔄 Changing monitoring level to: ${level}`);
            
            // MANUAL OVERRIDE CLEARING: Clear any manual overrides (fragile system)
            if (currentPatientId && window.sharedDataManager) {
                window.sharedDataManager.clearManualOverrides(currentPatientId, `temperature-risk-level-${level}`);
            }
            
            // Map button levels to temp circle levels
            const levelMapping = {
                'loose': 'low',
                'mid': 'mid',
                'tight': 'high'
            };
            
            const tempLevel = levelMapping[level] || level;
            console.log(`Mapped ${level} to temp level: ${tempLevel}`);
            
            // Update button states - remove active/selected from all buttons
            document.querySelectorAll('.button-group .btn').forEach(btn => {
                btn.classList.remove('active', 'selected');
            });
            
            // Add selected class to the clicked button
            const selectedButton = document.querySelector(`[data-level="${level}"]`);
            if (selectedButton) {
                selectedButton.classList.add('selected');
                console.log(`✅ Button ${level} selected`);
            }
            
            // Update temp circle if it exists
            if (window.tempCircle) {
                console.log(`🌡️ Updating temp circle to: ${tempLevel}`);
                window.tempCircle.setRiskLevel(tempLevel);
            } else {
                console.warn('❌ tempCircle not found');
            }
            
            // Save to SharedDataManager for global sync
            if (currentPatientId && window.sharedDataManager) {
                window.sharedDataManager.updateGlobalTempMonitoringLevel(currentPatientId, tempLevel);
                console.log(`✅ Saved temp level ${tempLevel} for patient ${currentPatientId}`);
                
                // Mark this as a recent manual change to prioritize it over calculated values
                sessionStorage.setItem('recentTempLevelChange', Date.now().toString());
            }
            
            // Update sliders if they exist
            updateSlidersMonitoringLevel(level);
            
            // CONDITIONAL WEBSOCKET TRIGGER: Only send immediately if NOT part of tag parameter changes
            // Tag parameter changes have their own delayed websocket trigger to ensure proper order
            const isPartOfTagChange = sessionStorage.getItem('tagParameterChangeInProgress');
            if (!isPartOfTagChange) {
                console.log(`📤 Risk level changed - sending current display state via websocket`);
                if (window.sharedDataManager) {
                    window.sharedDataManager.sendFullThresholdsRiskLevels(currentPatientId);
                }
            } else {
                console.log(`⏸️ Risk level changed - skipping immediate websocket (tag change in progress)`);
            }
            
            console.log(`✅ Monitoring level changed to: ${level} (temp: ${tempLevel})`);
        }

        // Function to update risk level buttons based on current temp monitoring level
        function updateRiskLevelButtons() {
            if (!currentPatientId || !window.sharedDataManager) return;
            
            // Get current temp monitoring level from data manager
            const currentTempLevel = window.sharedDataManager.getTempMonitoringLevel(currentPatientId);
            console.log(`🔄 Updating risk level buttons for temp level: ${currentTempLevel}`);
            
            // Map temp levels to button levels
            const levelMapping = {
                'low': 'loose',
                'mid': 'mid', 
                'high': 'tight'
            };
            
            const buttonLevel = levelMapping[currentTempLevel] || 'mid';
            
            // Update button selection
            const allButtons = document.querySelectorAll('.btn.risk-low, .btn.risk-med, .btn.risk-high');
            allButtons.forEach(btn => btn.classList.remove('selected'));
            
            // Add selected class to the correct button
            const targetButton = document.querySelector(`[data-level="${buttonLevel}"]`);
            if (targetButton) {
                targetButton.classList.add('selected');
                console.log(`✅ Updated risk level button selection to: ${buttonLevel} (temp level: ${currentTempLevel})`);
            } else {
                console.warn(`⚠️ Could not find button for level: ${buttonLevel}`);
            }
            
            // Also update the temp circle to reflect the new monitoring level
            if (window.tempCircle && typeof window.tempCircle.setRiskLevel === 'function') {
                window.tempCircle.setRiskLevel(currentTempLevel);
                console.log(`🌡️ Updated temp circle to reflect new monitoring level: ${currentTempLevel}`);
            } else {
                console.warn('⚠️ tempCircle not available for update');
            }
        }

        function initializePage() {
            console.log('🔄 Initializing respiratory settings page...');
            
            // Try to get patient and session data from multiple sources
            if (window.sharedDataManager) {
                // First, try to get from URL parameters (if navigated directly)
                const urlParams = new URLSearchParams(window.location.search);
                const urlPatient = urlParams.get('patient');
                const urlBed = urlParams.get('bed');
                
                // Second, try to get from session data
                const sessionData = window.sharedDataManager.getSessionData();
                
                // Use URL parameters if available, otherwise use session data
                currentPatientId = urlPatient || sessionData.currentPatient;
                currentBed = urlBed || sessionData.currentBed;
                
                console.log('📋 Patient sources - URL:', urlPatient, 'Session:', sessionData.currentPatient);
                console.log('🛏️ Bed sources - URL:', urlBed, 'Session:', sessionData.currentBed);
                console.log('✅ Final selection - Patient:', currentPatientId, 'Bed:', currentBed);
                
                // If still no patient/bed data, redirect to bed overview
                if (!currentPatientId || !currentBed) {
                    console.warn('⚠️ No patient or bed data found, redirecting to bed overview');
                    alert('Geen patiëntgegevens gevonden. Ga terug naar het bedoverzicht om een patiënt te selecteren.');
                    window.location.href = 'index.html';
                    return;
                }
                
                // Update session data to ensure consistency
                window.sharedDataManager.saveSessionData({
                    currentPatient: currentPatientId,
                    currentBed: currentBed,
                    lastUpdated: new Date().toISOString()
                });
                
                // Update header with patient info
                updatePatientHeader();
                
                // Initialize currentSettings from SharedDataManager
                initializeCurrentSettings();
                
                // Initialize monitoring level buttons to show saved state
                initializeMonitoringLevelButtons();
                
                // Initialize global variables for this patient (simple approach)
                if (window.sharedDataManager) {
                    window.sharedDataManager.initializeGlobalParameterVariables(currentPatientId);
                    console.log('✅ Global variables initialized for patient:', currentPatientId);
                }
            } else {
                console.error('❌ SharedDataManager not available');
                alert('Data manager niet beschikbaar. Herlaad de pagina.');
            }
        }

        function initializeMonitoringLevelButtons() {
            console.log('🔧 Initializing temperature monitoring level buttons...');
            
            if (!currentPatientId || !window.sharedDataManager) {
                console.warn('❌ Cannot initialize monitoring buttons - missing patient ID or SharedDataManager');
                return;
            }
            
            // Get the EFFECTIVE saved temp monitoring level (including tag adjustments)
            const savedLevel = window.sharedDataManager.getEffectiveTempMonitoringLevel(currentPatientId);
            console.log('📊 Saved EFFECTIVE temp monitoring level:', savedLevel);
            
            // Map temp levels back to button levels
            const levelMapping = {
                'low': 'loose',
                'mid': 'mid', 
                'high': 'tight'
            };
            
            const buttonLevel = levelMapping[savedLevel] || 'mid';
            console.log('🔄 Mapped to button level:', buttonLevel);
            
            // Update button states - remove active/selected from all buttons
            document.querySelectorAll('.button-group .btn').forEach(btn => {
                btn.classList.remove('active', 'selected');
            });
            
            // Add selected class to the appropriate button
            const targetButton = document.querySelector(`[data-level="${buttonLevel}"]`);
            if (targetButton) {
                targetButton.classList.add('selected');
                console.log(`✅ Button ${buttonLevel} marked as selected`);
            } else {
                console.warn(`❌ Button with level ${buttonLevel} not found`);
            }
            
            // Update temp circle if it exists
            if (window.tempCircle) {
                console.log(`🌡️ Setting temp circle to: ${savedLevel}`);
                window.tempCircle.setRiskLevel(savedLevel);
            } else {
                console.log('ℹ️ tempCircle not yet available - will be set when created');
            }
            
            // Update sliders to match the level
            updateSlidersMonitoringLevel(buttonLevel);
            
            console.log('✅ Temperature monitoring level buttons initialized');
        }

        function updatePatientHeader() {
            const headerElement = document.getElementById('patient-header-info');
            if (currentPatientId && currentBed) {
                const patientInfo = window.sharedDataManager.getPatientInfo(currentPatientId);
                const displayName = patientInfo?.name || `Patiënt ${currentPatientId}`;
                
                // Get medical information including main problem and risk level
                const medicalInfo = window.sharedDataManager.getPatientMedicalInfo(currentPatientId);
                
                let headerText = `${displayName} - Bed ${currentBed}`;
                
                // Add main problem if available
                if (medicalInfo?.selectedProblem) {
                    const problemMapping = {
                        'pneumonie': 'Pneumonie',
                        'pneumonia': 'Pneumonie',
                        'cardiac': 'Hartproblemen',
                        'surgery': 'Chirurgie',
                        'other': 'Anders'
                    };
                    const problemDisplay = problemMapping[medicalInfo.selectedProblem] || medicalInfo.selectedProblem;
                    headerText += ` | Hoofdprobleem: ${problemDisplay}`;
                }
                
                // Add risk level if available
                if (medicalInfo?.selectedRiskLevel) {
                    const riskMapping = {
                        'low': 'Laag',
                        'med': 'Middel',
                        'high': 'Hoog'
                    };
                    const riskDisplay = riskMapping[medicalInfo.selectedRiskLevel] || medicalInfo.selectedRiskLevel;
                    headerText += ` | Risiconiveau: ${riskDisplay}`;
                }
                
                headerElement.textContent = headerText;
            } else {
                headerElement.textContent = '';
            }
        }
        
        function initializeConditionStates() {
            console.log('🏥 Initializing condition states...');
            
            if (currentPatientId && window.sharedDataManager) {
                // Ensure patient has clean state for new setup (but don't force clean existing states)
                window.sharedDataManager.ensureCleanPatientState(currentPatientId, false);
                
                // Check if pneumonie is currently selected using the new condition state method
                const pneumonieState = window.sharedDataManager.getPatientConditionState('pneumonie', currentPatientId);
                
                const pneumonieButton = document.querySelector('.circulatory-tag[data-condition="pneumonie"]');
                if (pneumonieButton) {
                    if (pneumonieState && pneumonieState.isActive) {
                        pneumonieButton.classList.add('selected');
                        console.log('✅ Initialized pneumonie button as selected');
                    } else {
                        pneumonieButton.classList.remove('selected');
                        console.log('✅ Initialized pneumonie button as deselected');
                    }
                }
                
                // Check if herstellende is currently selected
                const herstellendeState = window.sharedDataManager.getPatientConditionState('herstellende', currentPatientId);
                
                const herstellendeButton = document.querySelector('.tag-btn[data-condition="herstellende"]');
                if (herstellendeButton) {
                    if (herstellendeState && herstellendeState.isActive) {
                        herstellendeButton.classList.add('selected');
                        console.log('✅ Initialized herstellende button as selected');
                    } else {
                        herstellendeButton.classList.remove('selected');
                        console.log('✅ Initialized herstellende button as deselected');
                    }
                }
            }
        }

        function setupEventListeners() {
            console.log('🔧 Setting up event listeners...');
            
            // FORCE SLIDER REFRESH FUNCTION: Can be called from other pages to update temperature slider
            window.forceTemperatureSliderRefresh = function() {
                console.log('💪 FORCE REFRESH - Temperature slider');
                console.log('💪 Global variables - TEMP:', window.TEMP_MIN, '-', window.TEMP_MAX);
                
                if (tempSlider && tempSlider.config && tempSlider.config.targetRange) {
                    console.log('💪 Force updating Temperature slider:', window.TEMP_MIN, '-', window.TEMP_MAX);
                    tempSlider.config.targetRange.min = window.TEMP_MIN;
                    tempSlider.config.targetRange.max = window.TEMP_MAX;
                    tempSlider.currentMin = window.TEMP_MIN;
                    tempSlider.currentMax = window.TEMP_MAX;
                    if (tempSlider.updateSliderPosition) {
                        tempSlider.updateSliderPosition();
                    }
                } else {
                    console.log('❌ Temperature slider not available for force refresh');
                }
            };
            
            // SIMPLE APPROACH: Listen for global parameter changes
            window.addEventListener('globalParametersChanged', function(event) {
                console.log('� Global parameters changed event received:', event.detail);
                // Update temperature slider with new global variables
                if (tempSlider && typeof tempSlider.updateConfig === 'function') {
                    tempSlider.updateConfig({
                        targetRange: { min: window.TEMP_MIN, max: window.TEMP_MAX }
                    });
                    // Force visual position refresh
                    if (tempSlider.updateSliderPosition) {
                        tempSlider.updateSliderPosition();
                    }
                    console.log('✅ Temperature slider updated from global parameters:', window.TEMP_MIN, '-', window.TEMP_MAX);
                }
            });

            // Listen for tag parameter changes (sepsis/pneumonie)
            window.addEventListener('tagParametersChanged', function(event) {
                console.log('🏷️ Other page received tag parameters changed:', event.detail);
                const { patientId, parameters } = event.detail;
                
                // Only update if it's for the current patient
                if (patientId === currentPatientId && parameters) {
                    // Update Temperature slider if tag parameters include Temperature
                    if (parameters.Temperature && tempSlider && typeof tempSlider.updateConfig === 'function') {
                        console.log('🔄 Updating Temperature slider from tag parameters:', parameters.Temperature.min, '-', parameters.Temperature.max);
                        tempSlider.updateConfig({
                            targetRange: { min: parameters.Temperature.min, max: parameters.Temperature.max }
                        });
                        if (tempSlider.updateSliderPosition) {
                            tempSlider.updateSliderPosition();
                        }
                        console.log('✅ Temperature slider updated from tag parameters');
                    }
                }
            });

            
            // UNIFIED TAG HANDLING: Set up tag button listeners
            const circulatoryTagButtons = document.querySelectorAll('.circulatory-tag');
            circulatoryTagButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const tagCondition = this.dataset.condition;
                    const isCurrentlySelected = this.classList.contains('selected');
                    const newState = !isCurrentlySelected;
                    
                    console.log(`🏷️ UNIFIED TAG (OTHER): ${tagCondition} clicked, changing from ${isCurrentlySelected} to ${newState}`);
                    
                    // Use unified tag system for pneumonie
                    if (tagCondition === 'pneumonie' && currentPatientId && window.sharedDataManager) {
                        const result = window.sharedDataManager.toggleConditionTag(currentPatientId, 'pneumonie', newState);
                        
                        if (result && result.skipped) {
                            console.log(`⚠️ UNIFIED TAG (OTHER): Tag ${tagCondition} toggle skipped - ${result.reason}`);
                            return; // Don't update UI if operation was skipped
                        }
                        
                        // Update local UI
                        if (newState) {
                            this.classList.add('selected');
                        } else {
                            this.classList.remove('selected');
                        }
                        
                        console.log(`🏷️ UNIFIED TAG (OTHER): ${tagCondition} ${newState ? 'selected' : 'deselected'} via unified system`);
                        
                        // Backup timeout to ensure UI updates - increased timeout for data manager processing
                        setTimeout(() => {
                            console.log('🔄 BACKUP (OTHER): Forcing AF slider refresh after data manager processing...');
                            if (window.afSlider && typeof window.afSlider.updateConfig === 'function') {
                                window.afSlider.updateConfig({
                                    targetRange: {
                                        min: window.AF_MIN,
                                        max: window.AF_MAX
                                    }
                                });
                                if (window.afSlider.updateSliderPosition) {
                                    window.afSlider.updateSliderPosition();
                                }
                            }
                            
                            // Update risk level buttons and temp circles
                            if (typeof updateRiskLevelButtons === 'function') {
                                updateRiskLevelButtons();
                            }
                            
                            // Additional backup after more time to ensure all async operations complete
                            setTimeout(() => {
                                console.log('🔄 SECONDARY BACKUP (OTHER): Final UI refresh...');
                                if (window.afSlider && typeof window.afSlider.updateConfig === 'function') {
                                    window.afSlider.updateConfig({
                                        targetRange: {
                                            min: window.AF_MIN,
                                            max: window.AF_MAX
                                        }
                                    });
                                    if (window.afSlider.updateSliderPosition) {
                                        window.afSlider.updateSliderPosition();
                                    }
                                }
                                if (typeof updateRiskLevelButtons === 'function') {
                                    updateRiskLevelButtons();
                                }
                            }, 100);
                        }, 150); // Increased from 50ms to 150ms
                    }
                });
            });
            
            // UNIFIED TAG SYSTEM: Listen for immediate UI updates after tag changes
            window.addEventListener('unifiedTagUIUpdateRequired', function(event) {
                console.log('🔄 UNIFIED TAG (OTHER): Immediate UI update required:', event.detail);
                
                const { patientId, activeTags, targetRanges, organStates } = event.detail;
                
                // Only update if it's for the current patient
                if (patientId === currentPatientId) {
                    console.log('🏷️ UNIFIED TAG (OTHER): Applying immediate UI updates...');
                    console.log('   - Active tags:', activeTags);
                    console.log('   - Target ranges:', targetRanges);
                    console.log('   - Organ states:', organStates);
                    
                    // Refresh AF slider if it exists
                    if (window.afSlider && targetRanges) {
                        console.log('🔄 UNIFIED TAG (OTHER): Refreshing AF slider...');
                        if (typeof window.afSlider.updateConfig === 'function') {
                            window.afSlider.updateConfig({
                                targetRange: {
                                    min: window.AF_MIN,
                                    max: window.AF_MAX
                                }
                            });
                            if (window.afSlider.updateSliderPosition) {
                                window.afSlider.updateSliderPosition();
                            }
                        }
                    }
                    
                    // Update risk level buttons to reflect new monitoring levels
                    updateRiskLevelButtons();
                    
                    console.log('✅ UNIFIED TAG (OTHER): Immediate UI updates completed');
                } else {
                    console.log('⏭️ UNIFIED TAG (OTHER): Skipping UI update - different patient');
                }
            });
            
            // UNIFIED TAG SYSTEM: Listen for unified tag state synchronization
            window.addEventListener('unifiedTagStateSyncRequired', function(event) {
                console.log('🔄 UNIFIED TAG (OTHER): Sync required event received:', event.detail);
                
                const { patientId, tagStates } = event.detail;
                
                // Only update if it's for the current patient
                if (patientId === currentPatientId) {
                    console.log('🏷️ UNIFIED TAG (OTHER): Syncing UI with tag states:', tagStates);
                    
                    // Update pneumonie button
                    if (tagStates.hasOwnProperty('pneumonie')) {
                        const pneumonieButton = document.querySelector('.circulatory-tag[data-condition="pneumonie"]');
                        if (pneumonieButton) {
                            if (tagStates.pneumonie) {
                                pneumonieButton.classList.add('selected');
                            } else {
                                pneumonieButton.classList.remove('selected');
                            }
                            console.log(`🏷️ UNIFIED TAG (OTHER): Synced pneumonie to ${tagStates.pneumonie ? 'SELECTED' : 'DESELECTED'}`);
                        }
                    }
                    
                    // Refresh UI with timeout to ensure data is processed
                    setTimeout(() => {
                        console.log('🔄 UNIFIED TAG (OTHER): Refreshing AF slider after sync event...');
                        if (window.afSlider && typeof window.afSlider.updateConfig === 'function') {
                            window.afSlider.updateConfig({
                                targetRange: {
                                    min: window.AF_MIN,
                                    max: window.AF_MAX
                                }
                            });
                            if (window.afSlider.updateSliderPosition) {
                                window.afSlider.updateSliderPosition();
                            }
                        }
                        updateRiskLevelButtons(); // Update risk level buttons too
                        console.log('✅ UNIFIED TAG (OTHER): AF slider refresh completed after sync');
                    }, 100);
                }
            });
            
            // LEGACY: Listen for condition state changes from other pages (for backward compatibility) 
            window.addEventListener('patientConditionStateChanged', function(event) {
                console.log('🫁 LEGACY (OTHER): Condition state changed event received:', event.detail);
                
                const { condition, state } = event.detail;
                
                // Only update if it's for the current patient
                if (state.patientId === currentPatientId) {
                    // Handle pneumonie condition (but skip unified triggers)
                    if (condition === 'pneumonie' && state.triggeredBy !== 'unified_toggle') {
                        const pneumonieButton = document.querySelector('.circulatory-tag[data-condition="pneumonie"]');
                        if (pneumonieButton) {
                            if (state.isActive) {
                                if (!pneumonieButton.classList.contains('selected')) {
                                    pneumonieButton.classList.add('selected');
                                    console.log('✅ LEGACY (OTHER): Synced pneumonie button to selected state from external change');
                                }
                            } else {
                                if (pneumonieButton.classList.contains('selected')) {
                                    pneumonieButton.classList.remove('selected');
                                    console.log('✅ LEGACY (OTHER): Synced pneumonie button to deselected state from external change');
                                }
                            }
                        }
                    }
                    
                    // Handle herstellende condition (non-unified tag)
                    if (condition === 'herstellende') {
                        const herstellendeButton = document.querySelector('.tag-btn[data-condition="herstellende"]');
                        if (herstellendeButton) {
                            if (state.isActive) {
                                if (!herstellendeButton.classList.contains('selected')) {
                                    herstellendeButton.classList.add('selected');
                                    console.log('✅ LEGACY (OTHER): Synced herstellende button to selected state from external change');
                                }
                            } else {
                                if (herstellendeButton.classList.contains('selected')) {
                                    herstellendeButton.classList.remove('selected');
                                    console.log('✅ LEGACY (OTHER): Synced herstellende button to deselected state from external change');
                                }
                            }
                        }
                    }
                }
            });
            
            // Listen for AF range changes from pneumonie selection/deselection
            window.addEventListener('afRangesChanged', function(event) {
                console.log('🫁 AF ranges changed event received in respiratory settings:', event.detail);
                
                const { patientId, AF_min, AF_max, source } = event.detail;
                
                // Only update if it's for the current patient
                if (patientId === currentPatientId && afSlider) {
                    console.log('🔄 Updating AF slider config and positions...');
                    
                    // Update the slider's config
                    afSlider.config.targetRange.min = AF_min;
                    afSlider.config.targetRange.max = AF_max;
                    
                    // Update the current slider handle positions to match the new range
                    afSlider.currentMin = AF_min;
                    afSlider.currentMax = AF_max;
                    
                    // Update the original values so the slider doesn't think these are user changes
                    afSlider.originalMin = AF_min;
                    afSlider.originalMax = AF_max;
                    
                    // Force re-render the slider to show new target range and positions
                    if (afSlider.updateSliderPosition) {
                        afSlider.updateSliderPosition();
                        console.log(`✅ Re-rendered AF slider with new target range and positions ${AF_min}-${AF_max} due to ${source}`);
                    } else {
                        console.warn('❌ updateSliderPosition method not available on AF slider');
                    }
                }
            });
            
            // Set up tag button listeners (for herstellende condition)
            const tagButtons = document.querySelectorAll('.tag-btn');
            tagButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const condition = this.dataset.condition;
                    
                    if (this.classList.contains('selected')) {
                        // Deselect tag
                        this.classList.remove('selected');
                        
                        // Handle condition deselection using condition state system
                        if (currentPatientId && window.sharedDataManager) {
                            window.sharedDataManager.setPatientConditionState(condition, {
                                isActive: false,
                                patientId: currentPatientId,
                                timestamp: Date.now(),
                                source: 'other-settings'
                            });
                            console.log(`🏷️ ${condition} deselected in other settings`);
                            
                            // Backup timeout to ensure UI updates for legacy tags
                            setTimeout(() => {
                                console.log(`🔄 LEGACY BACKUP (OTHER): Forcing UI refresh after ${condition} deselection...`);
                                if (window.afSlider && typeof window.afSlider.updateConfig === 'function') {
                                    window.afSlider.updateConfig({
                                        targetRange: {
                                            min: window.AF_MIN,
                                            max: window.AF_MAX
                                        }
                                    });
                                    if (window.afSlider.updateSliderPosition) {
                                        window.afSlider.updateSliderPosition();
                                    }
                                }
                                
                                // Update risk level buttons and temp circles
                                if (typeof updateRiskLevelButtons === 'function') {
                                    updateRiskLevelButtons();
                                }
                            }, 100);
                        }
                    } else {
                        // Select tag
                        this.classList.add('selected');
                        
                        // Handle condition selection using condition state system
                        if (currentPatientId && window.sharedDataManager) {
                            window.sharedDataManager.setPatientConditionState(condition, {
                                isActive: true,
                                patientId: currentPatientId,
                                timestamp: Date.now(),
                                source: 'other-settings'
                            });
                            console.log(`🏷️ ${condition} selected in other settings`);
                            
                            // Backup timeout to ensure UI updates for legacy tags
                            setTimeout(() => {
                                console.log(`🔄 LEGACY BACKUP (OTHER): Forcing UI refresh after ${condition} selection...`);
                                if (window.afSlider && typeof window.afSlider.updateConfig === 'function') {
                                    window.afSlider.updateConfig({
                                        targetRange: {
                                            min: window.AF_MIN,
                                            max: window.AF_MAX
                                        }
                                    });
                                    if (window.afSlider.updateSliderPosition) {
                                        window.afSlider.updateSliderPosition();
                                    }
                                }
                                
                                // Update risk level buttons and temp circles
                                if (typeof updateRiskLevelButtons === 'function') {
                                    updateRiskLevelButtons();
                                }
                            }, 100);
                        }
                    }
                });
            });
            
            // Event listeners are now handled by the slider components
        }
        



        function initializeSliders() {
            console.log('🎛️ Initializing temperature slider...');
            
            // Debug: Check if container exists
            const tempContainer = document.getElementById('temp-slider-container');
            console.log('Temperature Container found:', !!tempContainer);
            
            // Check if slider components are loaded
            console.log('VitalParameterSlider available:', !!window.VitalParameterSlider);
            console.log('SharedDataManager available:', !!window.sharedDataManager);
            
            if (!window.VitalParameterSlider) {
                console.error('❌ VitalParameterSlider class not found');
                if (tempContainer) tempContainer.innerHTML = '<p style="color: red;">Slider component not loaded - VitalParameterSlider missing</p>';
                return;
            }
            
            if (!currentPatientId) {
                console.error('❌ No patient ID available for slider');
                if (tempContainer) tempContainer.innerHTML = '<p style="color: orange;">No patient ID available</p>';
                return;
            }
            
            console.log('✅ All prerequisites met, creating temperature slider for patient:', currentPatientId);
            
            try {
                // Debug: Check what data we have
                console.log('Current patient ID:', currentPatientId);
                const patientInfo = window.sharedDataManager ? window.sharedDataManager.getPatientInfo(currentPatientId) : null;
                const patientSettings = window.sharedDataManager ? window.sharedDataManager.getPatientOtherSettings(currentPatientId) : null;
                console.log('Patient info:', patientInfo);
                console.log('Patient other settings:', patientSettings);
                
                // Initialize Temperature Slider
                if (tempContainer) {
                    console.log('🌡️ Creating Temperature slider...');
                    tempContainer.innerHTML = '<p style="color: blue;">Loading Temperature slider...</p>';
                    
                    try {
                        // GET ACTUAL STORED TARGET RANGES FIRST
                        let tempTargetRange = { min: 36.5, max: 37.5 }; // Safe defaults
                        
                        if (currentPatientId && window.sharedDataManager) {
                            const currentTargetRanges = window.sharedDataManager.getCurrentTargetRanges(currentPatientId);
                            if (currentTargetRanges && currentTargetRanges.Temperature) {
                                tempTargetRange = {
                                    min: currentTargetRanges.Temperature.min,
                                    max: currentTargetRanges.Temperature.max
                                };
                                console.log('📊 Using stored Temperature target range for slider initialization:', tempTargetRange);
                                
                                // Update global variables to match stored data
                                window.TEMP_MIN = tempTargetRange.min;
                                window.TEMP_MAX = tempTargetRange.max;
                                console.log('🔄 Updated global Temperature variables to match stored data:', window.TEMP_MIN, '-', window.TEMP_MAX);
                            } else {
                                console.log('⚠️ No stored Temperature target range found, using defaults:', tempTargetRange);
                                
                                // Set global variables to defaults
                                window.TEMP_MIN = tempTargetRange.min;
                                window.TEMP_MAX = tempTargetRange.max;
                            }
                        }
                        
                        tempSlider = new window.VitalParameterSlider(tempContainer, {
                            parameter: 'Temperature',
                            name: 'Temperatuur',
                            unit: '°C',
                            targetRange: tempTargetRange, // Use actual stored data, not global variables
                            yAxis: { min: 35, max: 42, step: 0.5 },
                            monitoringLevel: 'mid',
                            patientId: currentPatientId,
                            patientName: patientInfo?.name || `Patiënt ${currentPatientId}`,
                            onChange: (data) => {
                                console.log('Temperature Slider changed:', data);
                                if (window.sharedDataManager && data.type === 'save') {
                                    // MANUAL OVERRIDE DETECTION: Store as manual override
                                    if (currentPatientId) {
                                        const manualRange = {
                                            min: Math.round(data.min * 10) / 10,
                                            max: Math.round(data.max * 10) / 10,
                                            unit: '°C'
                                        };
                                        window.sharedDataManager.setManualOverride(currentPatientId, 'Temperature', manualRange, 'slider');
                                        console.log('🔧 MANUAL OVERRIDE: Stored Temperature manual override:', manualRange);
                                    }
                                    
                                    const newSettings = { temperature: { min: data.min, max: data.max } };
                                    window.sharedDataManager.savePatientOtherSettings(currentPatientId, newSettings);
                                    currentSettings = newSettings;
                                    
                                    // SIMPLE APPROACH: Direct update of global variables
                                    window.TEMP_MIN = Math.round(data.min * 10) / 10;
                                    window.TEMP_MAX = Math.round(data.max * 10) / 10;
                                    
                                    // Save to localStorage
                                    if (window.sharedDataManager) {
                                        window.sharedDataManager.saveGlobalParameterVariables();
                                        console.log('💾 Saved global variables to localStorage');
                                        
                                        // CRITICAL: Save to patient-specific storage for WebSocket messaging
                                        
                                        // DEBUG: Check data BEFORE saving
                                        console.log('🔍 BEFORE SAVE - Current target ranges:', window.sharedDataManager.getCurrentTargetRanges(currentPatientId));
                                        console.log('🔍 BEFORE SAVE - New Temperature:', window.TEMP_MIN, '-', window.TEMP_MAX);
                                        console.log('🔍 BEFORE SAVE - PatientId:', currentPatientId);
                                        
                                        window.sharedDataManager.updateCurrentTargetRange(currentPatientId, 'Temperature', {
                                            min: window.TEMP_MIN,
                                            max: window.TEMP_MAX,
                                            unit: '°C'
                                        }, 'slider-save');
                                        
                                        // DEBUG: Check data AFTER saving
                                        console.log('🔍 AFTER SAVE - Updated target ranges:', window.sharedDataManager.getCurrentTargetRanges(currentPatientId));
                                        
                                        // SEND WEBSOCKET MESSAGE: Manual threshold adjustment completed
                                        console.log('📤 Sending WebSocket message for manual Temperature threshold adjustment');
                                        console.log('🔧 MANUAL OVERRIDE WebSocket: Temperature manual override will be included in thresholds_risk_levels message');
                                        window.sharedDataManager.sendFullThresholdsRiskLevels(currentPatientId);
                                    }
                                    
                                    // Update all displays on all pages immediately
                                    console.log('🔄 Updating displays across all pages...');
                                    setTimeout(() => {
                                        window.dispatchEvent(new CustomEvent('globalParametersChanged', {
                                            detail: { parameter: 'Temperature', min: window.TEMP_MIN, max: window.TEMP_MAX }
                                        }));
                                    }, 10);
                                    
                                    console.log('✅ Temperature global variables updated:', window.TEMP_MIN, '-', window.TEMP_MAX);
                                }
                            }
                        });
                        
                        if (tempSlider) {
                            console.log('✅ Temperature Slider initialized successfully');
                        } else {
                            console.error('❌ Temperature Slider initialization returned null');
                            tempContainer.innerHTML = '<p style="color: red;">Temperature Slider initialization returned null</p>';
                        }
                    } catch (error) {
                        console.error('❌ Temperature Slider creation error:', error);
                        tempContainer.innerHTML = `<p style="color: red;">Temperature Slider error: ${error.message}</p>`;
                    }
                } else {
                    console.error('❌ Temperature container not found');
                }
                
            } catch (error) {
                console.error('❌ Error during slider initialization:', error);
                if (tempContainer) {
                    tempContainer.innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
                }
            }
        }
                            
                            // Check if pneumonie is currently active and force AF slider to use pneumonie ranges
                            if (currentPatientId && window.sharedDataManager) {
                                const pneumonieState = window.sharedDataManager.getPatientConditionState('pneumonie', currentPatientId);
                                console.log('🫁 Checking pneumonie state after AF slider creation:', pneumonieState);
                                
                                if (pneumonieState && pneumonieState.isActive) {
                                    console.log('🫁 Pneumonie is active - forcing AF slider to use 10-30 range');
                                    
                                    // Force the slider to use pneumonie ranges
                                    afSlider.config.targetRange.min = 10;
                                    afSlider.config.targetRange.max = 30;
                                    afSlider.currentMin = 10;
                                    afSlider.currentMax = 30;
                                    afSlider.originalMin = 10;
                                    afSlider.originalMax = 30;
                                    
                                    // Force re-render the slider to show pneumonie range
                                    if (afSlider.updateSliderPosition) {
                                        afSlider.updateSliderPosition();
                                        console.log('✅ AF slider forced to pneumonie range: 10-30 /min');
                                    }
                                }
                            }
        // Legacy functions removed - functionality now handled by slider components

        function goBackToAlarmOverview() {
            console.log('🔙 Navigating back to alarm overview');
            
            // Ensure session data is preserved when going back
            if (currentPatientId && currentBed && window.sharedDataManager) {
                // Update session data to maintain patient context
                window.sharedDataManager.saveSessionData({
                    currentPatient: currentPatientId,
                    currentBed: currentBed,
                    lastUpdated: new Date().toISOString()
                });
                
                console.log('✅ Session data preserved for patient:', currentPatientId, 'bed:', currentBed);
                
                // Navigate back to alarm overview with proper URL parameters
                const alarmUrl = `alarm-overview.html?bed=${currentBed}&patient=${currentPatientId}`;
                console.log('🔗 Navigating to:', alarmUrl);
                window.location.href = alarmUrl;
            } else {
                console.warn('⚠️ Missing patient or bed data, redirecting to bed overview');
                window.location.href = 'index.html';
            }
        }

        function goToCirculatorySettings() {
            console.log('➡️ Navigating to circulatory settings');
            
            // Ensure session data is preserved when going to circulatory
            if (currentPatientId && currentBed && window.sharedDataManager) {
                // Update session data to maintain patient context
                window.sharedDataManager.saveSessionData({
                    selectedBed: currentBed,
                    patientId: currentPatientId,
                    previousPage: 'respiratory-settings'
                });
                
                console.log('✅ Session data preserved for patient:', currentPatientId, 'bed:', currentBed);
                
                // Navigate to circulatory settings with proper URL parameters
                const circulatoryUrl = `circulatoir-settings.html?bed=${currentBed}&patient=${currentPatientId}`;
                console.log('🔗 Navigating to:', circulatoryUrl);
                window.location.href = circulatoryUrl;
            } else {
                console.warn('⚠️ Missing patient or bed data, redirecting to bed overview');
                window.location.href = 'index.html';
            }
        }

        function goToBedOverview() {
            console.log('🏠 Navigating to bed overview');
            
            // Clear current patient context since we're going back to the overview
            if (window.sharedDataManager) {
                window.sharedDataManager.saveSessionData({
                    selectedBed: null,
                    patientId: null,
                    previousPage: 'circulatoir-settings'
                });
                console.log('✅ Session data cleared for bed overview navigation');
            }
            
            // Navigate to bed overview
            window.location.href = 'index.html';
        }

        function goToBedOverview() {
            window.location.href = 'index.html';
        }
    </script>
</body>
</html>
